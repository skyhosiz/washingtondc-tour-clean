<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ยืนยันอีเมล | Washington D.C.</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap"
    rel="stylesheet"
  />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:"Kanit",sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:url("pic/dc_sunset.png") no-repeat center/cover;
    }
    .box {
      width: min(560px, 92vw);
      background: rgba(10,0,25,0.9);
      border-radius: 32px;
      padding: 32px 28px 26px;
      color: #fff;
      box-shadow: 0 0 40px rgba(0,0,0,.6);
      text-align: center;
    }
    h1 {
      font-size: 30px;
      margin-bottom: 10px;
      background: linear-gradient(90deg,#ffd089,#ff8a25);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      font-weight:800;
    }
    p {
      font-size: 16px;
      margin-bottom: 12px;
    }
    .ok {
      font-size: 18px;
      font-weight:700;
      margin: 12px 0 6px;
    }
    .btn-row {
      margin-top: 18px;
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
    }
    button {
      padding: 10px 24px;
      border-radius: 999px;
      border:none;
      font-size: 16px;
      font-weight:700;
      cursor:pointer;
      transition:.2s;
    }
    .btn-secondary {
      background: transparent;
      color:#ffd089;
      border:1px solid #ffd089;
    }
    .btn-primary {
      background: linear-gradient(90deg,#ffe29c,#ff8a25);
      color:#222;
    }
    button:hover { transform: translateY(-1px); }
  </style>
</head>
<body>
  <div class="box">
    <h1 id="title">กำลังยืนยันอีเมล…</h1>
    <p id="desc">โปรดรอสักครู่ ระบบกำลังตรวจสอบลิงก์ของคุณ</p>

    <div class="btn-row" id="btnRow" style="display:none">
      <button class="btn-secondary" onclick="location.href='intro.html'">
        หน้าแรก
      </button>
      <button class="btn-primary" onclick="location.href='login.html'">
        ไปหน้าเข้าสู่ระบบ
      </button>
    </div>
  </div>

  <script>
    const API_BASE =
      location.hostname === "localhost"
        ? "http://localhost:3000"
        : "https://washingtondc-tour-clean-1.onrender.com";

    const params = new URLSearchParams(location.search);
    const token = params.get("token");

    const titleEl = document.getElementById("title");
    const descEl  = document.getElementById("desc");
    const btnRow  = document.getElementById("btnRow");

    async function verifyEmail() {
      if (!token) {
        titleEl.textContent = "ลิงก์ยืนยันไม่ถูกต้อง";
        descEl.textContent = "ลิงก์นี้อาจไม่ถูกต้องหรือหมดอายุแล้ว";
        btnRow.style.display = "flex";
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/auth/verify-email`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token })
        });
        const data = await res.json().catch(() => ({}));

        if (data.status === "success") {
          // ✅ ตรงนี้คือข้อความสั้น ๆ ที่นายอยากได้
          titleEl.textContent = "ยืนยันอีเมลสำเร็จแล้ว ✅";
          descEl.textContent = "ตอนนี้คุณสามารถเข้าสู่ระบบด้วยอีเมลนี้ได้ทันที";
        } else {
          titleEl.textContent = "ลิงก์ยืนยันไม่ถูกต้อง";
          descEl.textContent = data.message || "ลิงก์นี้อาจหมดอายุแล้ว";
        }
      } catch (err) {
        console.error(err);
        titleEl.textContent = "ระบบมีปัญหา";
        descEl.textContent = "กรุณาลองเปิดลิงก์นี้ใหม่อีกครั้งภายหลัง";
      } finally {
        btnRow.style.display = "flex";
      }
    }

    verifyEmail();
  </script>
</body>
</html>
