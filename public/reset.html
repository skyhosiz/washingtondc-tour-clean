<!DOCTYPE html>
<html lang="th">
  <head>
    <!-- üìä Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-VGBZS316J9");
    </script>

    <!-- üîí Auth / Nav -->
    <script src="js/auth.js"></script>
    <script src="js/nav.js" defer></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password | Washington D.C.</title>

    <!-- üñã Font -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet" />

    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        font-family: "Kanit", sans-serif;
        display: flex; justify-content: center; align-items: center;
        height: 100svh; overflow: hidden;
        background: url("pic/dc_sunset.png") center/cover no-repeat fixed;
        color: #fff; position: relative;
      }
      .overlay {
        position: absolute; inset: 0;
        background: rgba(0,0,0,0.48);
        backdrop-filter: blur(2px);
      }
      .box {
        position: relative; z-index: 2;
        width: 100%; max-width: 420px;
        padding: 36px 32px; text-align: center;
        border-radius: 20px;
        background: rgba(10,0,25,0.85);
        box-shadow: 0 0 25px rgba(250,150,50,0.42);
        transform: translateY(-40px);
      }
      h2 {
        margin-bottom: 20px;
        font-size: 28px; font-weight: 800;
        background: linear-gradient(90deg, #ffc76b, #ff8a28);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-shadow: 0 0 12px rgba(255,150,50,0.45);
      }
      input, button {
        width: 100%; border: none; border-radius: 12px;
        padding: 15px; font-size: 17px; margin-top: 10px;
        outline: none; transition: 0.25s;
      }
      input { background: #fff; color: #222; }
      button {
        background: linear-gradient(90deg, #ffc76b, #ff8a28);
        color: #222; font-weight: 700; font-size: 18px;
        cursor: pointer;
      }
      button:hover { transform: scale(1.05); }
    </style>
  </head>

  <body>
    <div class="overlay"></div>

    <div class="box">
      <h2>‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
      <input type="password" id="pass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" />
      <input type="password" id="repass" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" />
      <button onclick="resetPassword()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    </div>

    <script>
      const API_BASE =
        location.hostname === "localhost"
          ? "http://localhost:3000"
          : "https://washingtondc-tour-clean.onrender.com";

      async function resetPassword() {
        const token = new URLSearchParams(location.search).get("token");
        if (!token || token.length < 20)
          return alert("‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏");

        const p = pass.value.trim(), rp = repass.value.trim();
        if (!p || !rp) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");
        if (p.length < 6) return alert("üîê ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß");
        if (p !== rp) return alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô!");

        try {
          const res = await fetch(`${API_BASE}/api/auth/reset`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token, password: p }),
          });
          const data = await res.json().catch(() => null);
          if (data?.status === "success") {
            gtag("event", "reset_password");
            alert("‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            return setTimeout(() => (location.href = "login.html"), 1000);
          }
          alert(data?.message || "‚ùå Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        } catch (err) {
          console.error("RESET ERROR:", err);
          alert("üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
        }
      }
    </script>
  </body>
</html>
