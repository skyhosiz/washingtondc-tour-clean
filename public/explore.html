<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explore D.C. | Washington D.C.</title>

    <!-- üîí Authentication & Navigation -->
    <script src="js/auth.js"></script>
    <script src="js/nav.js" defer></script>

    <!-- üñã Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- üìà Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-VGBZS316J9");
    </script>

    <!-- üé® Styles -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Kanit", sans-serif;
        background: radial-gradient(circle at top, #1c1a33, #0b0814);
        color: white;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: auto;
        padding: 100px 24px 40px;
      }

      /* üåÜ Modern gradient title */
      .page-title {
        position: relative;
        font-size: 40px;
        font-weight: 700;
        text-align: center;
        margin-bottom: 50px;
        padding: 20px 0;
        background: linear-gradient(90deg, #ffb84d, #ff7a00);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: 1px;
        text-shadow: 0 0 20px rgba(255, 136, 0, 0.3);
      }

      .page-title::before {
        content: "";
        position: absolute;
        left: 10%;
        right: 10%;
        top: 50%;
        transform: translateY(-50%);
        height: 70px;
        background: linear-gradient(
          90deg,
          rgba(255, 184, 77, 0.15),
          rgba(255, 122, 0, 0.15)
        );
        border-radius: 12px;
        filter: blur(10px);
        z-index: -1;
      }

      #loadingState {
        font-size: 20px;
        text-align: center;
        margin-top: 40px;
        color: #ffb84d;
      }

      #exploreGrid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
      }

      .explore-card {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        box-shadow: 0 0 15px rgba(255, 150, 60, 0.3);
        overflow: hidden;
        transition: transform 0.25s, box-shadow 0.25s;
      }

      .explore-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 0 25px rgba(255, 170, 70, 0.45);
      }

      .explore-card img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-bottom: 2px solid #ff952e;
        transition: opacity 0.3s ease;
      }

      .explore-card img.loading {
        opacity: 0.5;
      }

      .card-content {
        padding: 20px;
      }

      .explore-card h3 {
        font-size: 18px;
        margin-bottom: 8px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: #fff;
      }

      .explore-card p {
        font-size: 15px;
        color: #ccc;
        font-weight: 300;
      }

      .explore-card a {
        display: inline-block;
        margin-top: 10px;
        color: #ffb84d;
        text-decoration: none;
        font-weight: 500;
      }

      .explore-card a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 class="page-title">Explore D.C. Attractions</h1>
      <div id="exploreGrid"></div>
      <p id="loadingState">Loading data...</p>
    </div>

    <!-- üöÄ Script -->
    <script>
      const API_BASE =
        location.hostname === "localhost"
          ? "http://localhost:3000"
          : "https://washingtondc-tour-clean.onrender.com";

      document.addEventListener("DOMContentLoaded", () => {
        loadExploreData();
      });

      async function loadExploreData() {
        const token = localStorage.getItem("token");
        const grid = document.getElementById("exploreGrid");
        const loading = document.getElementById("loadingState");

        try {
          const res = await fetch(`${API_BASE}/api/explore`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          const data = await res.json();
          console.log("‚úÖ Smithsonian API Base Data:", data);

          if (data.status === "success" && data.data.rows.length > 0) {
            loading.style.display = "none";

            for (const item of data.data.rows) {
              const title = shortenTitle(item.title || "Untitled");
              const museum = item.unitCode || "Smithsonian Institution";
              let imageUrl = "pic/default.png";
              let detailUrl = "#";

              try {
                // üîó ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å Smithsonian API ‡∏à‡∏£‡∏¥‡∏á
                const recordRes = await fetch(
                  `https://edan.si.edu/openaccess/api/v1.0/content/${item.id}`
                );
                const recordData = await recordRes.json();

                const media =
                  recordData?.content?.descriptiveNonRepeating?.online_media
                    ?.media || [];

                if (media.length > 0) {
                  imageUrl =
                    media[0].content ||
                    media[0].thumbnail ||
                    media[0].resources?.[0]?.url ||
                    "pic/default.png";
                }

                detailUrl = `https://collections.si.edu/search/detail/${item.id}`;
              } catch (e) {
                console.warn("‚ö†Ô∏è Smithsonian fetch failed:", e);
              }

              const card = document.createElement("div");
              card.className = "explore-card";

              card.innerHTML = `
                <img src="${imageUrl}" alt="${title}"
                     onerror="this.onerror=null;this.src='pic/default.png';"
                     loading="lazy">
                <div class="card-content">
                  <h3 title="${item.title}">${title}</h3>
                  <p>${museum}</p>
                  <a href="${detailUrl}" target="_blank" rel="noopener noreferrer">
                    üîó ‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                  </a>
                </div>
              `;
              grid.appendChild(card);
            }
          } else {
            loading.textContent = "No data found or error.";
          }
        } catch (err) {
          console.error("‚ùå Fetch Error:", err);
          loading.textContent = "‚ö† Failed to load resources.";
        }
      }

      function shortenTitle(text, max = 55) {
        return text.length > max ? text.slice(0, max) + "..." : text;
      }
    </script>
  </body>
</html>
