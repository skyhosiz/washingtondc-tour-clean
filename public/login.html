<!DOCTYPE html>

<html lang="th">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"
    ></script>

    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }

      gtag("js", new Date());

      gtag("config", "G-VGBZS316J9");
    </script>

    <script src="js/auth.js"></script>

    <script src="js/nav.js" defer></script>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <title>Login | Washington D.C.</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;

        padding: 0;

        box-sizing: border-box;
      }

      body {
        font-family: "Kanit", sans-serif;

        background: url("pic/dc_sunset.png") center/cover no-repeat;

        min-height: 100svh; /* (‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 100vh) */

        display: flex;

        justify-content: center;

        align-items: center;
      }

      .login-box {
        width: 420px;

        padding: 38px;

        text-align: center;

        color: #fff;

        background: rgba(10, 0, 25, 0.85);

        border-radius: 26px;

        box-shadow: 0 0 38px rgba(255, 140, 30, 0.35);

        animation: fadeIn 0.6s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;

          transform: translateY(18px);
        }

        to {
          opacity: 1;

          transform: translateY(0);
        }
      }

      h2 {
        font-size: 34px;

        margin-bottom: 22px;

        font-weight: 800;

        background: linear-gradient(90deg, #ffd089, #ff8a25);

        /* --- 1. ‡πÄ‡∏≠‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á) --- */

        -webkit-background-clip: text;

        background-clip: text;

        color: transparent;
      }

      input,
      button {
        width: 100%;

        border: none;

        border-radius: 12px;

        font-size: 17px;

        margin: 10px 0;

        padding: 13px;
      }

      button {
        font-weight: 700;

        cursor: pointer;

        transition: 0.25s;

        color: #222;

        background: linear-gradient(90deg, #ffe29c, #ff8522);
      }

      button:hover {
        transform: scale(1.05);

        box-shadow: 0 0 26px rgba(255, 140, 30, 0.85);
      }

      .forgot,
      .register-box {
        font-size: 14px;

        margin-top: 6px;
      }

      .forgot a {
        color: #ffd28a;

        text-decoration: none;
      }

      .register-box a {
        background: #ff7a00;

        color: #fff;

        padding: 4px 12px;

        border-radius: 8px;

        text-decoration: none;

        font-weight: 700;
      }

      .register-box a:hover {
        background: #ff9831;
      }
    </style>
  </head>

  <body>
    <div class="login-box">
      <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

      <form id="loginForm" onsubmit="return false;">
        <input
          id="email"
          type="email"
          placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
          autocomplete="email"
        />

        <input
          id="password"
          type="password"
          placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
          autocomplete="current-password"
        />

        <div class="forgot"><a href="forgot.html">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a></div>

        <button onclick="login()">Login</button>

        <div class="register-box">
          <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?</span> <a href="register.html">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
        </div>
      </form>
    </div>

    <script>
      const API_BASE =
        location.hostname === "localhost"
          ? "http://localhost:3000"
          : "https://washingtondc-tour-clean.onrender.com";

      async function login() {
        // --- 2. ‡∏¢‡πâ‡∏≤‡∏¢ getElementById ‡∏°‡∏≤‡πÑ‡∏ß‡πâ "‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô" ---

        const emailEl = document.getElementById("email");

        const passwordEl = document.getElementById("password");

        // ------------------------------------------

        const email = emailEl.value.trim();

        const password = passwordEl.value.trim();

        if (!email || !password) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö üòé");

        try {
          const res = await fetch(`${API_BASE}/api/auth/login`, {
            method: "POST",

            headers: { "Content-Type": "application/json" },

            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (data.status === "success") {
            saveAuth(data); // (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ 'saveAuth' ‡∏à‡∏≤‡∏Å js/auth.js)

            gtag("event", "login", { method: "Email" });

            return (location.href = "index.html");
          }

          alert(data.message || "‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î!");
        } catch (e) {
          alert("üì° ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
        }
      }

      // (‡∏•‡∏ö const emailEl ‡πÅ‡∏•‡∏∞ passwordEl ‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)

      document.getElementById("loginForm").addEventListener("keypress", (e) => {
        if (e.key === "Enter") login();
      });
    </script>
  </body>
</html>
