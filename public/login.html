<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Washington D.C.</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <script>
      window.DISABLE_NAV_AUTH = true;
    </script>

    <script src="js/auth.js" defer></script>

    <script>
      (function () {
        if (window.DISABLE_NAV_AUTH) return;

        const token = localStorage.getItem("token");
        const user = JSON.parse(localStorage.getItem("user") || "{}");
        const current = location.pathname.split("/").pop() || "index.html";

        const nav = document.createElement("nav");
        nav.style.cssText = `
      width:100%;
      position:fixed;
      top:0; left:0;
      z-index:9999;
      background:#000;
      padding:14px 25px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-family:'Kanit',sans-serif;
      border-bottom:3px solid #9c542a;
    `;

        const links = [
          { name: "HOME", url: "index.html" },
          { name: "EXPLORE", url: "explore.html" },
          { name: "PROFILE", url: "profile.html" },
        ];

        let left = `<div style="display:flex;align-items:center;gap:26px;">
        <div style="font-weight:900;font-size:20px;color:#ff9650;">D.C. TOUR</div>`;
        links.forEach((l) => {
          const active = l.url === current;
          left += `
        <a href="${l.url}" 
        style="text-decoration:none;
        font-size:14px;
        font-weight:800;
        color:${active ? "#ff9650" : "#fff"};
        transition:.2s;">
        ${l.name}
        </a>
      `;
        });
        left += `</div>`;

        let right = `<div style="display:flex;align-items:center;gap:12px;">`;
        if (token) {
          right += `
        <span style="color:#ffd394;font-size:14px;font-weight:700;">
          ${user.username || user.email}
        </span>
        <button id="logoutBtn"
          style="background:#e63946;border:none;color:#fff;
          padding:6px 18px;border-radius:20px;font-weight:800;
          cursor:pointer;font-size:13px;transition:0.2s;">
          LOGOUT
        </button>
      `;
        }
        right += `</div>`;

        nav.innerHTML = left + right;
        document.body.prepend(nav);

        if (token) {
          const btn = document.getElementById("logoutBtn");
          btn.onclick = () => {
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            location.href = "login.html";
          };
        }
      })();
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: "Kanit", sans-serif;
        background: url("pic/dc_sunset.png") center/cover no-repeat fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        -webkit-tap-highlight-color: transparent;
      }
      .login-box {
        width: 100%;
        max-width: 420px;
        padding: 40px 34px;
        text-align: center;
        background: rgba(10, 0, 25, 0.85);
        border-radius: 26px;
        box-shadow: 0 0 38px rgba(255, 140, 30, 0.35);
        animation: fadeIn 0.6s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(18px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      h2 {
        font-size: 34px;
        margin-bottom: 22px;
        font-weight: 800;
        background: linear-gradient(90deg, #ffd089, #ff8a25);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 14px rgba(255, 150, 30, 0.45);
      }
      input,
      button {
        width: 100%;
        border: none;
        border-radius: 12px;
        font-size: 17px;
        margin: 10px 0;
        padding: 13px;
      }
      input {
        background: #fff;
        color: #222;
      }
      button {
        font-weight: 700;
        cursor: pointer;
        transition: 0.25s;
        color: #222;
        background: linear-gradient(90deg, #ffe29c, #ff8522);
      }
      button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 26px rgba(255, 140, 30, 0.85);
      }

      .forgot {
        width: 100%;
        text-align: right;
        margin-top: -2px;
        margin-bottom: 10px;
      }
      .forgot a {
        color: #ffd28a;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
      }

      .register-box {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
      }
      .register-box span {
        color: #ffd28a;
        font-weight: 700;
        background: none !important;
        padding: 0;
        border-radius: 0;
        box-shadow: none;
        line-height: 1.2;
        display: inline;
      }
      .register-box a {
        background: #ff7a00;
        color: #fff;
        padding: 6px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
      }
      .register-box a:hover {
        background: #ff9831;
      }
    </style>
  </head>

  <body>
    <div class="login-box">
      <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

      <form id="loginForm">
        <input
          id="email"
          type="email"
          placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
          autocomplete="email"
          required
        />
        <input
          id="password"
          type="password"
          placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
          autocomplete="current-password"
          required
        />

        <div class="forgot"><a href="forgot.html">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a></div>

        <button type="submit">Login</button>

        <div class="register-box">
          <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?</span>
          <a href="register.html">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
        </div>
      </form>
    </div>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();

          if (!email || !password) {
            return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");
          }

          try {
            const res = await fetch("/api/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password }),
            });

            const data = await res.json().catch(() => null);

            if (!res.ok || !data?.token) {
              return alert(data?.message || "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå");
            }

            localStorage.setItem("token", data.token);
            localStorage.setItem("user", JSON.stringify(data.user));

            location.href = "index.html";
          } catch (err) {
            console.error("Login Error:", err);
            alert("üö® ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
          }
        });
    </script>
  </body>
</html>
