<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password | Washington D.C.</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <script>
      window.DISABLE_NAV_AUTH = true;
    </script>

    <script src="js/auth.js" defer></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Kanit", sans-serif;
        background: url("pic/dc_sunset.png") center/cover no-repeat fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100svh;
        padding: 20px;
      }
      .box {
        width: 100%;
        max-width: 420px;
        padding: 40px 34px;
        text-align: center;
        background: rgba(10, 0, 25, 0.85);
        border-radius: 26px;
        box-shadow: 0 0 38px rgba(255, 140, 30, 0.35);
        animation: fade 0.6s ease-out;
      }
      @keyframes fade {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
        }
      }
      h2 {
        font-size: 32px;
        margin-bottom: 20px;
        font-weight: 800;
        background: linear-gradient(90deg, #ffd089, #ff8a25);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 14px rgba(255, 150, 30, 0.45);
      }
      p {
        color: #ffd499;
        font-size: 15px;
        margin-bottom: 10px;
      }
      input,
      button {
        width: 100%;
        border: none;
        border-radius: 12px;
        font-size: 17px;
        margin: 10px 0;
        padding: 13px;
      }
      input {
        background: #fff;
        color: #222;
      }
      button {
        font-weight: 700;
        cursor: pointer;
        transition: 0.25s;
        color: #222;
        background: linear-gradient(90deg, #ffe29c, #ff8522);
      }
      button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 26px rgba(255, 140, 30, 0.85);
      }
      a {
        display: block;
        margin-top: 12px;
        color: #ffd28a;
        text-decoration: none;
        font-weight: 600;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <h2>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</h2>
      <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</p>

      <input
        type="email"
        id="email"
        placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
        autocomplete="email"
        required
      />

      <button id="sendBtn" onclick="onForgot()">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>

      <a href="login.html">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
    </div>

    <script>
      const API_BASE =
        location.hostname === "localhost"
          ? "http://localhost:3000"
          : "https://washingtondc-tour-clean-1.onrender.com";

      const COOLDOWN = 150;
      const BTN = document.getElementById("sendBtn");
      const EMAIL = document.getElementById("email");

      checkCooldown();

      function checkCooldown() {
        const last = localStorage.getItem("resetCooldown");
        if (!last) return;

        const diff = Math.floor((Date.now() - parseInt(last)) / 1000);
        if (diff < COOLDOWN) {
          disableButton(COOLDOWN - diff);
        }
      }

      function disableButton(t) {
        BTN.disabled = true;
        BTN.innerText = `‡∏£‡∏≠ ${t} ‡∏ß‡∏¥`;

        const interval = setInterval(() => {
          t--;
          BTN.innerText = `‡∏£‡∏≠ ${t} ‡∏ß‡∏¥`;

          if (t <= 0) {
            clearInterval(interval);
            BTN.disabled = false;
            BTN.innerText = "‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï";
            localStorage.removeItem("resetCooldown");
          }
        }, 1000);
      }

      async function onForgot() {
        const email = EMAIL.value.trim();
        if (!email) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•!");

        BTN.disabled = true;
        BTN.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";

        try {
          const res = await fetch(`${API_BASE}/api/auth/forgot`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await res.json().catch(() => null);

          if (res.ok) {
            alert("‚úÖ ‡∏´‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
            localStorage.setItem("resetCooldown", Date.now());
            disableButton(COOLDOWN);
          } else {
            alert(data?.message || "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
            BTN.disabled = false;
            BTN.innerText = "‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï";
          }
        } catch (err) {
          console.error("Forgot Error:", err);
          alert("üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
          BTN.disabled = false;
          BTN.innerText = "‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï";
        }
      }
    </script>
  </body>
</html>
