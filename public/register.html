<!DOCTYPE html>
<html lang="th">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-VGBZS316J9");
    </script>

    <script src="js/auth.js"></script>
    <script src="js/nav.js" defer></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | Washington D.C.</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Kanit", sans-serif;
        height: 100svh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: url("pic/dc_sunset.png") no-repeat center/cover;
      }
      .reg-container {
        width: 420px;
        background: rgba(10, 0, 25, 0.83);
        border-radius: 26px;
        padding: 38px;
        text-align: center;
        color: white;
        box-shadow: 0 0 38px rgba(255, 140, 30, 0.28);
      }
      h2 {
        font-size: 34px;
        margin-bottom: 20px;
        font-weight: 800;
        background: linear-gradient(90deg, #ffd089, #ff8a25);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      input {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        font-size: 17px;
        margin: 10px 0;
        color: #333;
      }
      button {
        width: 100%;
        padding: 12px;
        margin-top: 12px;
        background: linear-gradient(90deg, #ffe29c, #ff8522);
        border: none;
        border-radius: 12px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.25s;
        color: #222;
      }
      button:hover {
        transform: scale(1.05);
      }
      .login-box {
        margin-top: 18px;
        font-size: 15px;
      }
      .login-box a {
        margin-left: 6px;
        padding: 4px 12px;
        background: #ff7a00;
        border-radius: 8px;
        text-decoration: none;
        color: white;
        font-weight: 700;
      }
      .login-box a:hover {
        background: #ff9831;
      }
    </style>
  </head>

  <body>
    <div class="reg-container">
      <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>

      <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (4‚Äì16 ‡∏ï‡∏±‡∏ß)" />
      <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" autocomplete="email" />
      <input
        type="password"
        id="password"
        placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‚â• 8 ‡∏ï‡∏±‡∏ß + ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)"
        autocomplete="new-password"
      />

      <button id="regBtn" onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>

      <div class="login-box">
        ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      </div>
    </div>

    <script>
      const API_BASE =
        location.hostname === "localhost"
          ? "http://localhost:3000"
          : "https://washingtondc-tour-clean-1.onrender.com";

      const BAD_DOMAINS = [
        "0-mail.com",
        "0815.ru",
        "10minutemail.com",
        "10minutemail.co.uk",
        "10minutemail.de",
        "10minutemail.fr",
        "10minutemail.net",
        "10minutemail.org",
        "10minutemailbox.com",
        "10minutemails.in",
        "10minutemail.us",
        "1st-forms.com",
        "20minutemail.com",
        "2prong.com",
        "3mail.ga",
        "4warding.net",
        "6paq.com",
        "9ox.net",
        "a-bc.net",
        "anonbox.net",
        "anonymbox.com",
        "antichef.com",
        "antichef.net",
        "antispam.de",
        "armyspy.com",
        "discard.email",
        "discardmail.com",
        "discardmail.de",
        "disposable-mail.com",
        "dodgeit.com",
        "dodgit.com",
        "dropmail.me",
        "e4ward.com",
        "emailondeck.com",
        "emailtemporanea.net",
        "emailtemporar.ro",
        "fakeinbox.com",
        "fakeinbox.net",
        "fakemail.fr",
        "fakemailgenerator.com",
        "flyspam.com",
        "getairmail.com",
        "getnada.com",
        "getonemail.com",
        "guerrillamail.biz",
        "guerrillamail.com",
        "guerrillamail.de",
        "guerrillamail.info",
        "guerrillamail.net",
        "guerrillamail.org",
        "guerrillamailblock.com",
        "inboxclean.com",
        "incognitomail.com",
        "instant-mail.de",
        "kasmail.com",
        "killmail.com",
        "killmail.net",
        "kismail.ru",
        "klassmaster.com",
        "klassmaster.net",
        "lol.ovpn.to",
        "lroid.com",
        "mail-temporaire.fr",
        "maildrop.cc",
        "mailnesia.com",
        "mailnull.com",
        "mailinator.com",
        "mailinator.org",
        "mailinator2.com",
        "mintemail.com",
        "moakt.com",
        "my10minutemail.com",
        "mytrashmail.com",
        "mytemp.email",
        "mailsac.com",
        "mailcatch.com",
        "mailtothis.com",
        "mailbox52.ga",
        "spam4.me",
        "spambooger.com",
        "spambog.com",
        "spambog.de",
        "spambog.ru",
        "spamex.com",
        "spamfree.eu",
        "spamfree24.de",
        "spamfree24.eu",
        "spamfree24.info",
        "spamfree24.net",
        "spamfree24.org",
        "spamfree24.com",
        "spamgourmet.com",
        "spammotel.com",
        "spamspot.com",
        "stop-my-spam.pp.ua",
        "superrito.com",
        "tagyourself.com",
        "temp-mail.com",
        "temp-mail.de",
        "temp-mail.org",
        "temp-mail.io",
        "tempmail.eu",
        "tempmail.de",
        "tempmailaddress.com",
        "tempmailbox.com",
        "tempmaildemo.com",
        "tempmailer.com",
        "tempmailer.de",
        "tempmailo.com",
        "tempmailpro.com",
        "tempmail.tork.org",
        "tempmail.us",
        "tempinbox.com",
        "tempmail.ca",
        "throwawaymail.com",
        "trashmail.com",
        "trash-mail.com",
        "trashmail.de",
        "trashmail.me",
        "trashmail.net",
        "trashmail.org",
        "instantemailaddress.com",
        "mvrht.net",
        "10minmail.info",
        "easytrashmail.com",
        "dudmail.com",
        "deadaddress.com",
        "0815.ru",
        "ezstest.com",
        "litedrop.com",
        "nowmymail.com",
        "rcpt.at",
        "spammail.me",
        "yopmail.com",
        "yopmail.fr",
        "yopmail.net",
        "yopmail.org",
        "yopmail.biz",
        " yopmail.info",
        "yopmail.pp.ua",
        "cool.fr.nf",
        "jetable.org",
        "hidemail.de",
        "sharklasers.com",
        "grr.la",
        "spam.su",
        "spamavert.com",
        "gishpuppy.com",
        "trashmail.io",
        "fux0ringduh.com",
        "mailme.lv",
        "nospam.wins.com",
        "nomail.ch",
        "nobulk.com",
        "kurzepost.de",
        "plexolan.de",
        "putthisinyourspamdatabase.com",
        "sendspamhere.com",
        "shitmail.me",
        "sneakemail.com",
        "stuffmail.de",
        "teleworm.us",
        "thismail.net",
        "wh4f.org",
        "whyspam.me",
        "wegwerpmailadres.nl",
        "wegwerfmail.de",
        "wegwerfemail.com",
        "wegwerf-email-addressen.de",
        "webemail.me",
        "walkmail.net",
        "veryrealemail.com",
        "trashymail.com",
        "20minutemail.it",
        "binkmail.com",
        "bugmenot.com",
        "meltmail.com",
        "spamcero.com",
        "spamthis.co.uk",
        "tempemail.net",
        "trbvm.com",
        "zoemail.org",
        "guerrillamailblock.com",
        "mailmoat.com",
        "uroid.com",
        "mailnesia.com",
        "spammotel.com",
      ];

      function strongPass(p) {
        return p.length >= 8 && /[A-Z]/.test(p) && /\d/.test(p);
      }

      async function register() {
        const btn = document.getElementById("regBtn");
        const username = usernameInput.value.trim();
        const email = emailInput.value.trim().toLowerCase();
        const password = passwordInput.value.trim();

        if (!username || !email || !password)
          return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");

        if (username.length < 4 || username.length > 16)
          return alert("‚ö†Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á 4‚Äì16 ‡∏ï‡∏±‡∏ß");

        if (!/^[A-Za-z0-9_.]+$/.test(username))
          return alert("‚ö†Ô∏è ‡πÉ‡∏ä‡πâ A-Z, 0-9, _, . ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
          return alert("üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");

        const domain = email.split("@")[1];
        if (BAD_DOMAINS.includes(domain))
          return alert("üö´ ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö‡∏ó‡∏¥‡πâ‡∏á!");

        if (!strongPass(password))
          return alert("üîê ‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‚â• 8 ‡∏ï‡∏±‡∏ß + ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç");

        btn.disabled = true;
        const oldText = btn.textContent;
        btn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...";

        try {
          const res = await fetch(`${API_BASE}/api/auth/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, email, password }),
          });

          const data = await res.json().catch(() => null);

          if (res.ok && data.status === "success") {
            alert("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\nüü° ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
            return (location.href = "login.html");
          }

          alert(data?.message || "‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß!");
        } catch (err) {
          console.error(err);
          alert("üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
        }

        btn.disabled = false;
        btn.textContent = oldText;
      }
    </script>

    <script>
      const usernameInput = document.getElementById("username");
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
    </script>
  </body>
</html>
