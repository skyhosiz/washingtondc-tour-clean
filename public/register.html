<!DOCTYPE html>
<html lang="th">
<head>
  <!-- üìä Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config","G-VGBZS316J9");
  </script>

  <!-- üîê Auth & Navbar -->
  <script src="js/auth.js"></script>
  <script src="js/nav.js" defer></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | Washington D.C.</title>

  <!-- üñã Font -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet" />

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:"Kanit",sans-serif;
      height:100svh;
      display:flex;justify-content:center;align-items:center;
      background:url("pic/dc_sunset.png") no-repeat center/cover;
    }
    .reg-container{
      width:420px;background:rgba(10,0,25,.83);
      border-radius:26px;padding:38px;text-align:center;color:white;
      box-shadow:0 0 38px rgba(255,140,30,.28);
    }
    h2{
      font-size:34px;margin-bottom:20px;font-weight:800;
      background:linear-gradient(90deg,#ffd089,#ff8a25);
      -webkit-background-clip:text;background-clip:text;color:transparent;
    }
    input{
      width:100%;padding:12px;border-radius:10px;border:none;
      font-size:17px;margin:10px 0;color:#333;
    }
    button{
      width:100%;padding:12px;margin-top:12px;
      background:linear-gradient(90deg,#ffe29c,#ff8522);
      border:none;border-radius:12px;font-size:18px;
      font-weight:bold;cursor:pointer;transition:.25s;color:#222;
    }
    button:hover{transform:scale(1.05)}
    .login-box{margin-top:18px;font-size:15px}
    .login-box a{
      margin-left:6px;padding:4px 12px;background:#ff7a00;
      border-radius:8px;text-decoration:none;color:white;font-weight:700;
    }
    .login-box a:hover{background:#ff9831}
  </style>
</head>

<body>
  <div class="reg-container">
    <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>

    <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (4‚Äì16 ‡∏ï‡∏±‡∏ß)">
    <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" autocomplete="email">
    <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà+‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)" autocomplete="new-password">

    <button id="regBtn" onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>

    <div class="login-box">
      ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
    </div>
  </div>

<script>
const API_BASE =
  location.hostname === "localhost"
    ? "http://localhost:3000"
    : "https://washingtondc-tour-clean-1.onrender.com";

// ‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏¥‡πâ‡∏á / spam domain
const BAD_DOMAINS = [
  "mailinator.com","yopmail.com","tempmail.com","guerrillamail.com",
  "10minutemail.com","trashmail.com","getnada.com","fakeinbox.com"
];

// ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ password ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á
function strongPass(p){
  return p.length>=8 && /[A-Z]/.test(p) && /\d/.test(p);
}

async function register(){
  const btn = document.getElementById("regBtn");
  const username = usernameInput.value.trim();
  const email = emailInput.value.trim().toLowerCase();
  const password = passwordInput.value.trim();

  if(!username || !email || !password)
    return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");

  if(username.length < 4 || username.length > 16)
    return alert("‚ö†Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á 4‚Äì16 ‡∏ï‡∏±‡∏ß");

  if(!/^[A-Za-z0-9_.]+$/.test(username))
    return alert("‚ö†Ô∏è ‡πÉ‡∏ä‡πâ A-Z, 0-9, _, . ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
    return alert("üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");

  const domain = email.split("@")[1];
  if(BAD_DOMAINS.includes(domain))
    return alert("üö´ ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö‡∏ó‡∏¥‡πâ‡∏á!");

  if(!strongPass(password))
    return alert("üîê ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‚â• 8 ‡∏ï‡∏±‡∏ß + ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç");

  btn.disabled = true;
  const oldText = btn.textContent;
  btn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...";

  try{
    const res = await fetch(`${API_BASE}/api/auth/register`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ username, email, password }),
    });

    const data = await res.json().catch(()=>null);

    if(res.ok && data.status === "success"){
      gtag("event","sign_up",{ method:"Email" });
      alert("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
      return location.href = "login.html";
    }

    alert(data?.message || "‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß!");

  }catch(err){
    alert("üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
  }

  btn.disabled = false;
  btn.textContent = oldText;
}
</script>

<script>
const usernameInput = document.getElementById("username");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
</script>

</body>
</html>
