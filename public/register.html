<!DOCTYPE html>
<html lang="th">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-VGBZS316J9");
  </script>

  <script src="js/auth.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | Washington D.C.</title>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: "Kanit", sans-serif;
      min-height:100svh;
      background:url("pic/dc_sunset.png") center/cover no-repeat;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .reg-container {
      width:420px;
      padding:38px;
      background:rgba(10,0,25,0.83);
      border-radius:26px;
      text-align:center;
      color:white;
      box-shadow:0 0 38px rgba(255,140,30,0.28);
      animation:fadein .7s ease-out;
    }
    @keyframes fadein {
      from {opacity:0; transform:translateY(18px);}
      to {opacity:1; transform:translateY(0);}
    }
    h2 {
      font-size:34px;
      margin-bottom:20px;
      font-weight:800;
      background: linear-gradient(90deg,#ffd089,#ff8a25);
      -webkit-background-clip:text;
      color:transparent;
    }
    input,button {
      width:100%;
      font-size:17px;
      border:none;
      border-radius:12px;
      margin:10px 0;
      padding:12px;
    }
    button {
      background:linear-gradient(90deg,#ffe29c,#ff8522);
      font-weight:bold;
      cursor:pointer;
      transition:.25s;
      color:#222;
    }
    button:hover { transform:scale(1.05); }
    .login-box {
      margin-top:18px;
      font-size:15px;
    }
    .login-box a {
      padding:4px 12px;
      background:#ff7a00;
      border-radius:8px;
      color:white;
      text-decoration:none;
      font-weight:700;
      margin-left:6px;
    }
  </style>
</head>

<body>
  <div class="reg-container">
    <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>

    <input id="username" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
    <input id="email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
    <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">

    <button id="regBtn" onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>

    <div class="login-box">
      ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
    </div>
  </div>

  <script>
    const API_BASE =
      location.hostname === "localhost"
        ? "http://localhost:3000"
        : "https://washingtondc-tour-clean.onrender.com";

    async function register() {
      const btn = document.getElementById("regBtn");
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !email || !password)
        return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");

      const emailPattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
      if (!emailPattern.test(email))
        return alert("üìß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      btn.disabled = true;
      const oldText = btn.textContent;
      btn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...";

      try {
        const res = await fetch(`${API_BASE}/api/auth/register`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ username, email, password })
        });

        const data = await res.json();

        if (data.status === "success") {
          gtag("event", "sign_up", { method: "Email" });
          alert("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          return location.href = "login.html";
        }

        alert(data.message || "‚ùå ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
      } catch (err) {
        alert("üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
      } finally {
        btn.disabled = false;
        btn.textContent = oldText;
      }
    }

    document.addEventListener("keypress",(e)=>{
      if(e.key==="Enter") register();
    });
  </script>
</body>
</html>
