<!DOCTYPE html>
<html lang="th">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-VGBZS316J9"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-VGBZS316J9");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smithsonian Museum ‚Äî Washington D.C.</title>

    <script src="js/auth.js"></script>
    <script src="js/nav.js" defer></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      *{margin:0;padding:0;box-sizing:border-box;font-family:"Kanit",sans-serif}
      body{
        background:#000 url("pic/smith-bg.png") center/cover fixed no-repeat;
        color:#fff;text-align:center;overflow-x:hidden
      }
      html{scroll-behavior:smooth}
      .reveal{opacity:0;transform:translateY(40px);transition:all .9s cubic-bezier(.17,.67,.83,.67)}
      .reveal.show{opacity:1;transform:translateY(0)}
      header{padding:100px 8% 50px}
      header img{width:55%;max-width:900px;border-radius:12px;border:4px solid #e09555;box-shadow:0 0 35px rgba(0,0,0,.65)}
      h1{
        font-size:60px;margin-top:25px;font-weight:800;
        background:linear-gradient(90deg,#ffe7b3,#ffae52);
        -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;color:transparent
      }
      h2{opacity:.92;font-size:22px;margin-top:10px}
      section{
        width:88%;max-width:980px;margin:20px auto 60px;
        background:rgba(0,0,0,.55);backdrop-filter:blur(6px);
        padding:45px 35px;border-radius:16px
      }
      section h3{
        font-size:30px;margin-bottom:22px;
        background:linear-gradient(90deg,#ffd28a,#ff952e);
        -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;color:transparent
      }
      p{font-size:19px;line-height:1.7;color:#eee}
      .btn-box{margin-top:30px;display:flex;justify-content:center;gap:15px}
      .btnBack,.btnView{padding:12px 28px;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:.25s}
      .btnBack{background:#ffb049;color:#222}
      .btnBack:hover{background:#ffce7b;transform:scale(1.07)}
      .btnView{background:#e55b5b;color:#fff}
      .btnView:hover{background:#ff8282;transform:scale(1.07)}
      footer{padding:35px 0;opacity:.85;font-size:14px}
    </style>
  </head>

  <body>
    <header class="reveal">
      <img src="pic/smith-top.png" alt="Smithsonian Institution Poster" />
      <h1>Smithsonian Museum</h1>
      <h2>The Heart of Knowledge in Washington D.C.</h2>
    </header>

    <section class="reveal">
      <h3>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏™‡∏°‡∏¥‡∏ò‡πÇ‡∏ã‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô</h3>
      <p>
        ‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏™‡∏°‡∏¥‡∏ò‡πÇ‡∏ã‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å
        ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Å‡∏ß‡πà‡∏≤ 19 ‡πÅ‡∏´‡πà‡∏á‡∏ó‡∏±‡πà‡∏ß‡∏ß‡∏≠‡∏ä‡∏¥‡∏á‡∏ï‡∏±‡∏ô ‡∏î‡∏µ.‡∏ã‡∏µ.
        ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 136
        ‡∏•‡πâ‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏•‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏´‡∏°‡πà ‡πÜ
      </p>

      <div class="btn-box">
        <button class="btnBack" onclick="location.href='index.html'">‚Üê Back to Home</button>
        <button class="btnView" onclick="window.open('https://www.si.edu/', '_blank')">üîé Official Website</button>
      </div>
    </section>

    <footer class="reveal">
      ¬© 2025 Washington D.C. Tourism Project ‚Äî Smithsonian Museum | Developed by FlukeTON
    </footer>

    <script>
      const reveals = document.querySelectorAll(".reveal");
      function revealElements() {
        const windowHeight = window.innerHeight;
        reveals.forEach((el) => {
          const elementTop = el.getBoundingClientRect().top;
          if (elementTop < windowHeight - 120) el.classList.add("show");
        });
      }
      window.addEventListener("scroll", revealElements);
      revealElements();
    </script>

    <div id="quiz-widget" style="position:fixed;right:18px;bottom:18px;z-index:9999">
      <button id="quiz-btn" style="padding:10px 14px;border:0;border-radius:12px;background:#00eaff;color:#001018;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(0,234,255,.25)">
        Quiz Me üéØ
      </button>
    </div>

    <div id="quiz-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:10000;align-items:center;justify-content:center">
      <div style="width:min(520px,92%);background:#0b0f14;color:#eaf7ff;border:1px solid #163544;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.5)">
        <div style="padding:16px 18px;border-bottom:1px solid #163544;display:flex;justify-content:space-between;align-items:center">
          <strong>Quiz Challenge</strong>
          <button id="quiz-close" style="background:transparent;border:0;color:#9ecfe0;font-size:18px;cursor:pointer">‚úï</button>
        </div>
        <div id="quiz-body" style="padding:18px;max-height:70vh;overflow:auto">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‚Ä¶</div>
      </div>
    </div>

    <script>
    (() => {
      const $ = (s, r = document) => r.querySelector(s);
      const $$ = (s, r = document) => [...r.querySelectorAll(s)];

      function extractSummary() {
        const el = document.querySelector("#main") || document.body;
        return el.innerText.replace(/\s+/g, " ").trim().slice(0, 2000);
      }

      async function fetchQuiz() {
        const payload = { url: location.pathname || location.href, lang: "th", summary: extractSummary() };
        const res = await fetch("/api/quiz", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error("quiz_fetch_fail");
        return res.json();
      }

      function renderQuiz(quiz) {
        const box = $("#quiz-body");
        box.innerHTML = "";
        const qs = quiz.questions || [];

        qs.forEach((q, i) => {
          const wrap = document.createElement("div");
          wrap.style.marginBottom = "16px";
          wrap.innerHTML = `
            <div style="margin-bottom:8px;font-weight:700">${i + 1}. ${q.stem}</div>
            ${q.choices.map((c, idx) => `
              <label style="display:block;margin:6px 0;cursor:pointer">
                <input type="radio" name="q${i}" value="${idx}" style="margin-right:6px"> ${c}
              </label>
            `).join("")}
            <div class="explain" style="display:none;margin-top:6px;color:#9dd8ff;font-size:14px"></div>
            <hr style="border:0;border-top:1px solid #163544;margin:12px 0 0">
          `;
          box.appendChild(wrap);
        });

        const submit = document.createElement("button");
        submit.textContent = "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö";
        submit.style = "margin-top:8px;padding:10px 14px;border:0;border-radius:10px;background:#28e07c;color:#00230f;font-weight:800;cursor:pointer";
        submit.onclick = async () => {
          let correctCount = 0;
          const answers = [];

          qs.forEach((q, i) => {
            const pick = parseInt((box.querySelector(`input[name="q${i}"]:checked`) || {}).value ?? "-1", 10);
            const ok = pick === (q.answerIndex | 0);
            if (ok) correctCount++;
            answers.push({ qIndex: i, pick });

            const exp = $$(".explain", box)[i];
            exp.style.display = "block";
            exp.textContent = (ok ? "‚úî ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Äî " : "‚úñ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‚Äî ") + (q.explain || "");
          });

          if (window.gtag) gtag("event", "quiz_submit", { page_path: location.pathname, score: correctCount, total: qs.length });

          try {
            await fetch("/api/quiz/submit", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ url: location.pathname, answers, questions: qs })
            });
          } catch {}

          const done = document.createElement("div");
          done.style = "margin-top:10px;font-weight:800";
          done.textContent = `‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${correctCount}/${qs.length}`;
          box.appendChild(done);

          if (correctCount === qs.length) {
            localStorage.setItem("quiz:mastered:" + location.pathname, "1");
          }
        };

        box.appendChild(submit);
      }

      $("#quiz-btn").onclick = async () => {
        $("#quiz-modal").style.display = "flex";
        $("#quiz-body").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‚Ä¶";
        try {
          const quiz = await fetchQuiz();
          renderQuiz(quiz);
        } catch (e) {
          $("#quiz-body").textContent = "‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏¥‡∏ã‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
        }
      };
      $("#quiz-close").onclick = () => $("#quiz-modal").style.display = "none";

      const main = document.querySelector("#main") || document.body;
      let t = 0, hinted = false;
      setInterval(() => {
        const r = main.getBoundingClientRect();
        const inView = r.top < innerHeight * 0.9 && r.bottom > innerHeight * 0.1;
        if (inView) t += 1;
        if (!hinted && t >= 20) {
          hinted = true;
          $("#quiz-btn").textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÑ‡∏´‡∏°? üéØ";
        }
      }, 1000);
    })();
    </script>
  </body>
</html>
